# Caching

## Direct Map Caching

#### **_Summary:_**
Direct Map Caching is a means of caching in which each block of memory is mapped to a specific location in the cache. This means that each block of memory can only be stored in one location in the cache. This is the simplest form of caching, but it is also the least efficient. This is because if two blocks of memory are mapped to the same location in the cache, then one of them will be overwritten. This is called a **_collision_**.

#### **_Definitions:_**
- **Collision**
: When two blocks of memory are mapped to the same location in the cache.

#### **_Example:_**

Lets say we have an 8 block cache, and each block is 4 words long. This means that the cache can hold 32 words of memory. Lets say we have the following word addresses:
- 43
- 171
- 45
- 178
- 179
- 5
- 174
- 46
- 4
- 181
- 65
- 180

1. **Convert to Byte Addresses:**

| Word Addresses | Byte Addresses |
| ------------ | -------------- |
| 43           | 0010 1011       |
| 171          | 1010 1011       |
| 45           | 0010 1101       |
| 178          | 1011 0010       |
| 179          | 1011 0011       |
| 5            | 0000 0101       |
| 174          | 1010 1110       |
| 46           | 0010 1110       |
| 4            | 0000 0100       |
| 181          | 1011 0101       |
| 65           | 0100 0001       |
| 180          | 1011 0100       |

2. **Decompose the Byte Addresses:**

Since there are 4 words in a block, we need 2 bits to represent the word within the block (since 2^2 = 4).

Since there are 8 blocks in the cache, we need 3 bits to represent the index within the cache (since 2^3 = 8).

That leaves us with 30 - 2 - 3 = 25 bits for the tag.

| Number | Address | Tag | Index | Word |
| ----  | ------- | --- | ----- | ---- |
| 43    | ... 0000 0010 1011 | ... 0001 | 010 | 11 |
| 171   | ... 0000 1010 1011 | ... 0101 | 010 | 11 |
| 45    | ... 0000 0010 1101 | ... 0001 | 011 | 01 |
| 178   | ... 0000 1011 0010 | ... 0101 | 001 | 10 |
| 179   | ... 0000 1011 0011 | ... 0101 | 001 | 11 |
| 5     | ... 0000 0000 0101 | ... 0000 | 001 | 01 |
| 174   | ... 0000 1010 1110 | ... 0101 | 110 | 10 |
| 46    | ... 0000 0010 1110 | ... 0001 | 011 | 10 |
| 4     | ... 0000 0000 0100 | ... 0000 | 000 | 00 |
| 181   | ... 0000 1011 0101 | ... 0101 | 101 | 01 |
| 65    | ... 0000 0100 0001 | ... 0010 | 000 | 01 |
| 180   | ... 0000 1011 0100 | ... 0101 | 101 | 00 |

Cache Initial State:

| Index | Tag | Word 3 | Word 2 | Word 1 | Word 0 |
| ----- | --- | ------ | ------ | ------ | ------ |
| 000   | ...      | ...  | ...  | ...  | ...  |
| 001   | ...      | ...  | ...  | ...  | ...  |
| 010   | ...      | ...  | ...  | ...  | ...  |
| 011   | ...      | ...  | ...  | ...  | ...  |
| 100   | ...      | ...  | ...  | ...  | ...  |
| 101   | ...      | ...  | ...  | ...  | ...  |
| 110   | ...      | ...  | ...  | ...  | ...  |
| 111   | ...      | ...  | ...  | ...  | ...  |

3. **Map the Addresses to the Cache:**
<details><summary>All my work</summary>
<p>

Word Address 43: (Miss)
| Index | Tag  | Word 3 | Word 2 | Word 1 | Word 0 |
|-----|------|-----|-----|-----|-----|
| 000 | None | ……… | ……… | ……… | ……… |
| 001 | None | ……… | ……… | ……… | ……… |
| 010 | 0001 | 43  | 42  | 41  | 40  |
| 011 | None | ……… | ……… | ……… | ……… |
| 100 | None | ……… | ……… | ……… | ……… |
| 101 | None | ……… | ……… | ……… | ……… |
| 110 | None | ……… | ……… | ……… | ……… |
| 111 | None | ……… | ……… | ……… | ……… |

Word Address 171: (Miss)
| Index | Tag  | Word 3 | Word 2 | Word 1 | Word 0 |
|-----|------|-----|-----|-----|-----|
| 000 | None | ……… | ……… | ……… | ……… |
| 001 | None | ……… | ……… | ……… | ……… |
| 010 | 0101 | 171 | 170 | 169 | 168 |
| 011 | None | ……… | ……… | ……… | ……… |
| 100 | None | ……… | ……… | ……… | ……… |
| 101 | None | ……… | ……… | ……… | ……… |
| 110 | None | ……… | ……… | ……… | ……… |
| 111 | None | ……… | ……… | ……… | ……… |

Word Address 45: (Miss)
| Index | Tag  | Word 3 | Word 2 | Word 1 | Word 0 |
|-----|------|-----|-----|-----|-----|
| 000 | None | ……… | ……… | ……… | ……… |
| 001 | None | ……… | ……… | ……… | ……… |
| 010 | 0101 | 171 | 170 | 169 | 168 |
| 011 | 0001 | 47  | 46  | 45  | 44  |
| 100 | None | ……… | ……… | ……… | ……… |
| 101 | None | ……… | ……… | ……… | ……… |
| 110 | None | ……… | ……… | ……… | ……… |
| 111 | None | ……… | ……… | ……… | ……… |

Word Address 178: (Miss)
| Index | Tag  | Word 3 | Word 2 | Word 1 | Word 0 |
|-----|------|-----|-----|-----|-----|
| 000 | None | ……… | ……… | ……… | ……… |
| 001 | None | ……… | ……… | ……… | ……… |
| 010 | 0101 | 171 | 170 | 169 | 168 |
| 011 | 0001 | 47  | 46  | 45  | 44  |
| 100 | 0101 | 179 | 178 | 177 | 176 |
| 101 | None | ……… | ……… | ……… | ……… |
| 110 | None | ……… | ……… | ……… | ……… |
| 111 | None | ……… | ……… | ……… | ……… |

Word Address 179: (Hit)
| Index | Tag  | Word 3 | Word 2 | Word 1 | Word 0 |
|-----|------|-----|-----|-----|-----|
| 000 | None | ……… | ……… | ……… | ……… |
| 001 | None | ……… | ……… | ……… | ……… |
| 010 | 0101 | 171 | 170 | 169 | 168 |
| 011 | 0001 | 47  | 46  | 45  | 44  |
| 100 | 0101 | 179 | 178 | 177 | 176 |
| 101 | None | ……… | ……… | ……… | ……… |
| 110 | None | ……… | ……… | ……… | ……… |
| 111 | None | ……… | ……… | ……… | ……… |

Word Address 5: (Miss)
| Index | Tag  | Word 3 | Word 2 | Word 1 | Word 0 |
|-----|------|-----|-----|-----|-----|
| 000 | None | ……… | ……… | ……… | ……… |
| 001 | 0000 | 7   | 6   | 5   | 4   |
| 010 | 0101 | 171 | 170 | 169 | 168 |
| 011 | 0001 | 47  | 46  | 45  | 44  |
| 100 | 0101 | 179 | 178 | 177 | 176 |
| 101 | None | ……… | ……… | ……… | ……… |
| 110 | None | ……… | ……… | ……… | ……… |
| 111 | None | ……… | ……… | ……… | ……… |

Word Address 174: (Miss)
| Index | Tag  | Word 3 | Word 2 | Word 1 | Word 0 |
|-----|------|-----|-----|-----|-----|
| 000 | None | ……… | ……… | ……… | ……… |
| 001 | 0000 | 7   | 6   | 5   | 4   |
| 010 | 0101 | 171 | 170 | 169 | 168 |
| 011 | 0101 | 175 | 174 | 173 | 172 |
| 100 | 0101 | 179 | 178 | 177 | 176 |
| 101 | None | ……… | ……… | ……… | ……… |
| 110 | None | ……… | ……… | ……… | ……… |
| 111 | None | ……… | ……… | ……… | ……… |

Word Address 46: (Miss)
| Index | Tag  | Word 3 | Word 2 | Word 1 | Word 0 |
|-----|------|-----|-----|-----|-----|
| 000 | None | ……… | ……… | ……… | ……… |
| 001 | 0000 | 7   | 6   | 5   | 4   |
| 010 | 0101 | 171 | 170 | 169 | 168 |
| 011 | 0001 | 47  | 46  | 45  | 44  |
| 100 | 0101 | 179 | 178 | 177 | 176 |
| 101 | None | ……… | ……… | ……… | ……… |
| 110 | None | ……… | ……… | ……… | ……… |
| 111 | None | ……… | ……… | ……… | ……… |

Word Address 4: (Hit)
| Index | Tag  | Word 3 | Word 2 | Word 1 | Word 0 |
|-----|------|-----|-----|-----|-----|
| 000 | None | ……… | ……… | ……… | ……… |
| 001 | 0000 | 7   | 6   | 5   | 4   |
| 010 | 0101 | 171 | 170 | 169 | 168 |
| 011 | 0001 | 47  | 46  | 45  | 44  |
| 100 | 0101 | 179 | 178 | 177 | 176 |
| 101 | None | ……… | ……… | ……… | ……… |
| 110 | None | ……… | ……… | ……… | ……… |
| 111 | None | ……… | ……… | ……… | ……… |

Word Address 181: (Miss)
| Index | Tag  | Word 3 | Word 2 | Word 1 | Word 0 |
|-----|------|-----|-----|-----|-----|
| 000 | None | ……… | ……… | ……… | ……… |
| 001 | 0000 | 7   | 6   | 5   | 4   |
| 010 | 0101 | 171 | 170 | 169 | 168 |
| 011 | 0001 | 47  | 46  | 45  | 44  |
| 100 | 0101 | 179 | 178 | 177 | 176 |
| 101 | 0101 | 183 | 182 | 181 | 180 |
| 110 | None | ……… | ……… | ……… | ……… |
| 111 | None | ……… | ……… | ……… | ……… |

Word Address 65: (Miss)
| Index | Tag  | Word 3 | Word 2 | Word 1 | Word 0 |
|-----|------|-----|-----|-----|-----|
| 000 | 0010 | 67  | 66  | 65  | 64  |
| 001 | 0000 | 7   | 6   | 5   | 4   |
| 010 | 0101 | 171 | 170 | 169 | 168 |
| 011 | 0001 | 47  | 46  | 45  | 44  |
| 100 | 0101 | 179 | 178 | 177 | 176 |
| 101 | 0101 | 183 | 182 | 181 | 180 |
| 110 | None | ……… | ……… | ……… | ……… |
| 111 | None | ……… | ……… | ……… | ……… |

Word Address 180: (Hit)
| Index | Tag  | Word 3 | Word 2 | Word 1 | Word 0 |
|-----|------|-----|-----|-----|-----|
| 000 | 0010 | 67  | 66  | 65  | 64  |
| 001 | 0000 | 7   | 6   | 5   | 4   |
| 010 | 0101 | 171 | 170 | 169 | 168 |
| 011 | 0001 | 47  | 46  | 45  | 44  |
| 100 | 0101 | 179 | 178 | 177 | 176 |
| 101 | 0101 | 183 | 182 | 181 | 180 |
| 110 | None | ……… | ……… | ……… | ……… |
| 111 | None | ……… | ……… | ……… | ……… |

</p>
</details> 

Final Cache State:

| Index | Tag  | Word 3 | Word 2 | Word 1 | Word 0 |
|-----|------|-----|-----|-----|-----|
| 000 | 0010 | 67  | 66  | 65  | 64  |
| 001 | 0000 | 7   | 6   | 5   | 4   |
| 010 | 0101 | 171 | 170 | 169 | 168 |
| 011 | 0001 | 47  | 46  | 45  | 44  |
| 100 | 0101 | 179 | 178 | 177 | 176 |
| 101 | 0101 | 183 | 182 | 181 | 180 |
| 110 | None | ……… | ……… | ……… | ……… |
| 111 | None | ……… | ……… | ……… | ……… |

This cache resulted in a 3/12 hit rate.

#### **_Tricky Things to Remember:_**
- Dont forget to do this!

***